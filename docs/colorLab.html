<!DOCTYPE html>

<html>
<head>
  <title>colorLab.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>colorLab.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>colorLab.js
(c) 2013 Stefan Huber, Signalwerk GmbH
colorLab may be freely distributed under the MIT license.
For all details and documentation:
http://colorlabjs.org</code></pre>
<h2>colorLab Class</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>At the moment there ist just support for CIELAB 
Initialize the Class with </p>
<pre><code>new colorLab(&#39;CIELAB&#39;, [2, 4, 6]);</code></pre>
<p>or </p>
<pre><code>new colorLab(&#39;CIELAB&#39;);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> colorLab = (<span class="keyword">function</span>(space, values){</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>Initial Setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Save a reference to the global object </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> root = <span class="keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Current version of the library.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.VERSION = <span class="string">'0.0.1'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>constatnats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.kK = <span class="number">24389.0</span> / <span class="number">27.0</span>;
    <span class="keyword">this</span>.kE = <span class="number">216.0</span> / <span class="number">24389.0</span>;


    <span class="keyword">this</span>._currentSpace = <span class="string">"none"</span>;
    <span class="keyword">this</span>._CIELAB = {};
    <span class="keyword">this</span>._CMYK = {};

    <span class="keyword">this</span>.helper = {};

    <span class="keyword">this</span>.helper.math = {

        toDegrees: <span class="keyword">function</span>(angle) {
          <span class="keyword">return</span> angle * (<span class="number">180</span> / Math.PI);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Converts numeric degrees to radians </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toRad: <span class="keyword">function</span>(num) {
            <span class="keyword">return</span> num * Math.PI / <span class="number">180</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Convert from 0-1 to 0-255</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        to8bit : <span class="keyword">function</span>(num)
        {
            <span class="keyword">return</span> Math.round(Math.min(<span class="number">255</span>, Math.max(<span class="number">0</span>, (num*<span class="number">255</span>))));
        }


    };

    <span class="keyword">this</span>.helper.convert = {


        CIEXYZCIELAB : <span class="keyword">function</span>(XYZ, RefWhite) {

            <span class="keyword">var</span> fHelper = <span class="function"><span class="keyword">function</span> <span class="params">(t)</span> {</span>
                <span class="keyword">if</span> (t &gt; root.kE) {
                    <span class="keyword">return</span> Math.pow(t, <span class="number">1.0</span> / <span class="number">3.0</span>);
                } <span class="keyword">else</span> {
                    <span class="keyword">return</span> ((root.kK * t + <span class="number">16.0</span>) / <span class="number">116.0</span>);
                }
            };

            <span class="keyword">var</span> fx = fHelper(XYZ.X / RefWhite.X);
            <span class="keyword">var</span> fy = fHelper(XYZ.Y / RefWhite.Y);
            <span class="keyword">var</span> fz = fHelper(XYZ.Z / RefWhite.Z);

            <span class="keyword">var</span> Lab = {};
            Lab.L = <span class="number">116.0</span> * fy - <span class="number">16.0</span>;
            Lab.a = <span class="number">500.0</span> * (fx - fy);
            Lab.b = <span class="number">200.0</span> * (fy - fz);
            <span class="keyword">return</span> Lab;
        },

        XYZRGB : <span class="keyword">function</span>(XYZ, RefMtx) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>(Observer = 2°, Illuminant = D65)
Chromatic Adaptation to implement: <a href="http://www.brucelindbloom.com/index.html?WorkingSpaceInfo.html">http://www.brucelindbloom.com/index.html?WorkingSpaceInfo.html</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> fHelper = <span class="function"><span class="keyword">function</span> <span class="params">(t)</span> {</span>

                <span class="keyword">if</span> (t &lt;= <span class="number">0.0031308</span>) {
                    <span class="keyword">return</span> <span class="number">12.92</span> * t;
                } <span class="keyword">else</span> {
                    <span class="keyword">return</span> <span class="number">1.055</span> * Math.pow(t, <span class="number">1</span>/<span class="number">2.4</span>) - <span class="number">0.055</span>;
                }
            };
            
            <span class="keyword">var</span> RGB = {};
            RGB.R = XYZ.X * RefMtx.m1 + XYZ.Y * RefMtx.m4 + XYZ.Z * RefMtx.m7;
            RGB.G = XYZ.X * RefMtx.m2 + XYZ.Y * RefMtx.m5 + XYZ.Z * RefMtx.m8;
            RGB.B = XYZ.X * RefMtx.m3 + XYZ.Y * RefMtx.m6 + XYZ.Z * RefMtx.m9;

            RGB.R = fHelper(RGB.R);
            RGB.G = fHelper(RGB.G);
            RGB.B = fHelper(RGB.B);


            <span class="keyword">return</span> RGB;
        },

        XYZRGB8BIT : <span class="keyword">function</span>(XYZ, RefMtx) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>(Observer = 2°, Illuminant = D65)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> RGB = root.helper.convert.XYZRGB(XYZ, RefMtx);

            RGB.R = root.helper.math.to8bit(RGB.R);
            RGB.G = root.helper.math.to8bit(RGB.G);
            RGB.B = root.helper.math.to8bit(RGB.B);

            <span class="keyword">return</span> RGB;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3>to work in the CIELAB colorspace</h3>
<p>use it with <code>colorLab.CIELAB</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.CIELAB = {
        init: <span class="keyword">function</span>(L, a, b) {
            root._CIELAB = {L:<span class="number">0</span>,a:<span class="number">0</span>,b:<span class="number">0</span>};
            <span class="keyword">this</span>.L(L);
            <span class="keyword">this</span>.a(a);
            <span class="keyword">this</span>.b(b);
        },

        L: <span class="keyword">function</span>(L) {
            <span class="keyword">if</span> (L === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CIELAB.L;
            } <span class="keyword">else</span> {
                root._CIELAB.L = L;
            }
        },
        a: <span class="keyword">function</span>(a) {
            <span class="keyword">if</span> (a === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CIELAB.a;
            } <span class="keyword">else</span> {
                root._CIELAB.a = a;
            }
        },
        b: <span class="keyword">function</span>(b) {
            <span class="keyword">if</span> (b === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CIELAB.b;
            } <span class="keyword">else</span> {
                root._CIELAB.b = b;
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>add value to pint like <code>add({x:1,y:2})</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        add: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a + b;});
        },
        sub: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a - b;});
        },
        mul: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a * b;});
        },
        div: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a / b;});
        },
        floor: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(<span class="literal">null</span>, <span class="keyword">function</span>(a) {<span class="keyword">return</span> Math.floor(a);});
        },
        round: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(<span class="literal">null</span>, <span class="keyword">function</span>(a) {<span class="keyword">return</span> Math.round(a);});
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4>general function template</h4>
<p>this is the general template to run the generalized functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _fnTemplate: <span class="keyword">function</span>(other, op) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>run function without an additional numeric imput like <code>add(2)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (<span class="keyword">typeof</span>(other) === <span class="string">'number'</span>) {
                <span class="keyword">this</span>.L( op(<span class="keyword">this</span>.L(), other) );
                <span class="keyword">this</span>.a( op(<span class="keyword">this</span>.a(), other) );
                <span class="keyword">this</span>.b( op(<span class="keyword">this</span>.b(), other) );
                <span class="keyword">return</span> <span class="keyword">this</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>run function without an additional imput like <code>round()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (other === <span class="literal">null</span>) {
                <span class="keyword">this</span>.L( op(<span class="keyword">this</span>.L()) );
                <span class="keyword">this</span>.a( op(<span class="keyword">this</span>.a()) );
                <span class="keyword">this</span>.b( op(<span class="keyword">this</span>.b()) );
                <span class="keyword">return</span> <span class="keyword">this</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>run function without an additional imput of type colorLab or objects <code>add({L:2,a:3,b:2})</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (other.CIELAB === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.L( op(<span class="keyword">this</span>.L(), other.L) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.L( op(<span class="keyword">this</span>.L(), other.CIELAB.L()) );
            }

            <span class="keyword">if</span> (other.CIELAB === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.a( op(<span class="keyword">this</span>.a(), other.a) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.a( op(<span class="keyword">this</span>.a(), other.CIELAB.a()) );
            }

            <span class="keyword">if</span> (other.CIELAB === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.b( op(<span class="keyword">this</span>.b(), other.b) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.b( op(<span class="keyword">this</span>.b(), other.CIELAB.b()) );
            }

            <span class="keyword">return</span> <span class="keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><a href="http://lofi.forum.physorg.com/Convertion-from-nanometers-to-CIELAB-values_7984.html">http://lofi.forum.physorg.com/Convertion-from-nanometers-to-CIELAB-values_7984.html</a>
Tristimulus values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        spectrum: <span class="keyword">function</span>(spectralSet) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>with illuminant D !!!!!!! and 2° CIE1931</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            
            <span class="keyword">var</span> XYZ = { X: <span class="number">0.0</span>, Y: <span class="number">0.0</span>, Z: <span class="number">0.0</span>};
            <span class="keyword">var</span> totalGet = <span class="number">0</span>;

            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; spectralSet.length; i++) {


                <span class="keyword">var</span> currentNm = spectralSet[i].nm;

                <span class="keyword">var</span> accordingIlluminant = colorLab.illuminant.D.filter(<span class="function"><span class="keyword">function</span> <span class="params">(el)</span> {</span>
                    <span class="keyword">return</span>  el.nm == currentNm;
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>look for the current illuminant-value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (accordingIlluminant.length != <span class="number">1</span>) {
                    <span class="keyword">throw</span> {
                        type:       <span class="string">"data"</span>,
                        message:     <span class="string">"there is no corresponding illumination value for current nm"</span>
                    };
                } <span class="keyword">else</span> {
                    accordingIlluminant = accordingIlluminant[<span class="number">0</span>];
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>look for the current Observer-value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">var</span> accordingObserver = colorLab.observer.CIE1931.filter(<span class="function"><span class="keyword">function</span> <span class="params">(el)</span> {</span>
                    <span class="keyword">return</span>  el.nm == currentNm;
                });

                <span class="keyword">if</span> (accordingObserver.length != <span class="number">1</span>) {
                    <span class="keyword">throw</span> {
                        type:       <span class="string">"data"</span>,
                        message:     <span class="string">"there is no corresponding nm-Value in the observer-data"</span>
                    };
                } <span class="keyword">else</span> {
                    accordingObserver = accordingObserver[<span class="number">0</span>];
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>we need this to normalize the data afterwards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                totalGet += accordingObserver.xyz[<span class="number">1</span>]*accordingIlluminant.power;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>sum up all values in the nm-array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                XYZ.X += accordingObserver.xyz[<span class="number">0</span>]*accordingIlluminant.power*spectralSet[i].value;
                XYZ.Y += accordingObserver.xyz[<span class="number">1</span>]*accordingIlluminant.power*spectralSet[i].value;
                XYZ.Z += accordingObserver.xyz[<span class="number">2</span>]*accordingIlluminant.power*spectralSet[i].value;


            }


             XYZ.X = XYZ.X / totalGet;
             XYZ.Y = XYZ.Y / totalGet;
             XYZ.Z = XYZ.Z / totalGet;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>convert to CIELAB with D-Illuminant</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> specLAB = root.helper.convert.CIEXYZCIELAB (
                { X: XYZ.X, Y: XYZ.Y, Z: XYZ.Z},
                { X: <span class="number">0.96397188</span>, Y: <span class="number">1.0</span>, Z: <span class="number">0.824037097</span>}
            );

            <span class="keyword">this</span>.L( specLAB.L );
            <span class="keyword">this</span>.a( specLAB.a );
            <span class="keyword">this</span>.b( specLAB.b );
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>find deltaE of two colorLab Variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        CIEDE2000: <span class="keyword">function</span>(newPoint) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>for more details see 
<a href="http://www.ece.rochester.edu/~gsharma/ciede2000/">http://www.ece.rochester.edu/~gsharma/ciede2000/</a>
<a href="http://www.ece.rochester.edu/~gsharma/ciede2000/ciede2000noteCRNA.pdf">http://www.ece.rochester.edu/~gsharma/ciede2000/ciede2000noteCRNA.pdf</a>
<a href="http://www.ece.rochester.edu/~gsharma/ciede2000/dataNprograms/deltaE2000.m">http://www.ece.rochester.edu/~gsharma/ciede2000/dataNprograms/deltaE2000.m</a>
<a href="http://en.wikipedia.org/wiki/Color_difference">http://en.wikipedia.org/wiki/Color_difference</a></p>
<p>weighting factors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> k_L = <span class="number">1</span>;
            <span class="keyword">var</span> k_C = <span class="number">1</span>;
            <span class="keyword">var</span> k_H = <span class="number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Input Lab pairs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> Lab1 = {
                L: <span class="keyword">this</span>.L(),
                a: <span class="keyword">this</span>.a(),
                b: <span class="keyword">this</span>.b()
            };
            <span class="keyword">var</span> Lab2 = {
                L: newPoint.CIELAB.L(),
                a: newPoint.CIELAB.a(),
                b: newPoint.CIELAB.b()
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>we calculate a C* to compensate later the for chroma</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            Lab1.C = Math.sqrt(Math.pow(Lab1.a, <span class="number">2</span>) + Math.pow(Lab1.b, <span class="number">2</span>));
            Lab2.C = Math.sqrt(Math.pow(Lab2.a, <span class="number">2</span>) + Math.pow(Lab2.b, <span class="number">2</span>));

            <span class="keyword">var</span> C_avr = (Lab1.C + Lab2.C) / <span class="number">2</span>; <span class="comment">// average of the two C</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>console.log(Lab1);
console.log(Lab2);</p>
<p>get G for the colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> G = <span class="number">0.5</span> * (<span class="number">1</span> - Math.sqrt(Math.pow(C_avr, <span class="number">7</span>) / (Math.pow(C_avr, <span class="number">7</span>) + Math.pow(<span class="number">25</span>, <span class="number">7</span>))));</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>console.log(&quot;G&quot;, G);</p>
<p>add for both colors the a&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            Lab1.a_1 = (<span class="number">1</span> + G) * Lab1.a;
            Lab2.a_1 = (<span class="number">1</span> + G) * Lab2.a;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>console.log(&quot;Lab1.a_1&quot;, Lab1.a_1);
console.log(&quot;Lab2.a_1&quot;, Lab2.a_1);</p>
<p>add for both colors the C&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            Lab1.C_1 = Math.sqrt(Math.pow(Lab1.a_1, <span class="number">2</span>) + Math.pow(Lab1.b, <span class="number">2</span>));
            Lab2.C_1 = Math.sqrt(Math.pow(Lab2.a_1, <span class="number">2</span>) + Math.pow(Lab2.b, <span class="number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>console.log(&quot;Lab1.C_1&quot;, Lab1.C_1);
console.log(&quot;Lab2.C_1&quot;, Lab2.C_1);</p>
<p>add h&#39; for both colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (Lab1.a_1 === <span class="number">0</span> &amp;&amp; Lab1.b === <span class="number">0</span>) {
                Lab1.h = <span class="number">0</span>;
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (Lab1.b &gt;= <span class="number">0</span>) {
                    Lab1.h = root.helper.math.toDegrees(Math.atan2(Lab1.b, Lab1.a_1));
                } <span class="keyword">else</span> {
                    Lab1.h = root.helper.math.toDegrees(Math.atan2(Lab1.b, Lab1.a_1)) + <span class="number">360</span>;
                }
            }

            <span class="keyword">if</span> (Lab2.a_1 === <span class="number">0</span> &amp;&amp; Lab2.b === <span class="number">0</span>) {
                Lab2.h = <span class="number">0</span>;
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (Lab2.b &gt;= <span class="number">0</span>) {
                    Lab2.h = root.helper.math.toDegrees(Math.atan2(Lab2.b, Lab2.a_1));
                } <span class="keyword">else</span> {
                    Lab2.h = root.helper.math.toDegrees(Math.atan2(Lab2.b, Lab2.a_1)) + <span class="number">360</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>console.log(&quot;Lab1.h&quot;,Lab1.h);
console.log(&quot;Lab2.h&quot;,Lab2.h);</p>
<p>Now calculate the signed differences in lightness, chroma, and hue</p>
<p>get the delta h and delta H</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> deltah;
            <span class="keyword">if</span> ( ( Lab1.C_1 * Lab2.C_1 ) === <span class="number">0</span> ) {
               deltah = <span class="number">0</span>;
            } <span class="keyword">else</span> {
               <span class="keyword">if</span> ( Math.abs( Lab2.h - Lab1.h ) &lt;= <span class="number">180</span> ) {
                  deltah = Lab2.h - Lab1.h;
               } <span class="keyword">else</span> {
                  <span class="keyword">if</span> ( Lab2.h - Lab1.h &gt; <span class="number">180</span> ) {
                    deltah = Lab2.h - Lab1.h - <span class="number">360</span>;
                  } <span class="keyword">else</span> {
                    deltah = Lab2.h - Lab1.h + <span class="number">360</span>;
                  }
               }
            }
            <span class="keyword">var</span> deltaH = <span class="number">2</span> * Math.sqrt( Lab1.C_1 * Lab2.C_1 ) * Math.sin( root.helper.math.toRad( deltah / <span class="number">2</span> ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>console.log(&quot;deltah: &quot;, deltah);
console.log(&quot;deltaH: &quot;, deltaH);</p>
<p>the delta for lightness</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> deltaL = Lab1.L - Lab2.L;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>console.log(&quot;deltaL&quot;, deltaL);</p>
<p>the delta for chroma</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> deltaC = Lab2.C_1 - Lab1.C_1;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>console.log(&quot;deltaC&quot;, deltaC);</p>
<p>Calculate CIEDE2000 Color-Difference </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> L_ave = (Lab1.L + Lab2.L) / <span class="number">2</span>;
            <span class="keyword">var</span> C_1ave = (Lab1.C_1 + Lab2.C_1) / <span class="number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>console.log(&quot;L_ave&quot;, L_ave);
console.log(&quot;C_1ave&quot;, C_1ave);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> hDiff;
            <span class="keyword">if</span> ( ( Lab1.C_1 * Lab2.C_1 ) === <span class="number">0</span> ) {
               hDiff = Lab1.h + Lab2.h;
            } <span class="keyword">else</span> {
               <span class="keyword">if</span> ( Math.abs( Lab2.h - Lab1.h ) &gt;  <span class="number">180</span> ) {
                  <span class="keyword">if</span> ( ( Lab2.h  + Lab1.h ) &lt;  <span class="number">360</span> ) {
                    hDiff = Lab1.h + Lab2.h + <span class="number">360</span>;
                  } <span class="keyword">else</span> {
                    hDiff = Lab1.h + Lab2.h - <span class="number">360</span>;
                  }
               } <span class="keyword">else</span> {
                  hDiff = Lab1.h + Lab2.h ;
               }
               hDiff = hDiff / <span class="number">2</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>console.log(&quot;hDiff&quot;, hDiff);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> L_aveMinus50pow2 = Math.pow((L_ave - <span class="number">50</span>), <span class="number">2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>console.log(&quot;L_aveMinus50pow2&quot;, L_aveMinus50pow2);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> SL = <span class="number">1</span> + ((<span class="number">0.015</span> * L_aveMinus50pow2) / Math.sqrt(<span class="number">20</span> + L_aveMinus50pow2));</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>console.log(&quot;SL&quot;, SL);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> SC = <span class="number">1</span> + <span class="number">0.045</span> * C_1ave;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>console.log(&quot;SC&quot;, SC);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> T = <span class="number">1</span> - <span class="number">0.17</span> * Math.cos( root.helper.math.toRad( hDiff - <span class="number">30</span> ) ) + <span class="number">0.24</span> * Math.cos( root.helper.math.toRad( <span class="number">2</span> * hDiff ) ) + <span class="number">0.32</span> * Math.cos( root.helper.math.toRad( <span class="number">3</span> * hDiff + <span class="number">6</span> ) ) - <span class="number">0.20</span> * Math.cos( root.helper.math.toRad( <span class="number">4</span> * hDiff - <span class="number">63</span> ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>console.log(&quot;T&quot;, T);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> SH = <span class="number">1</span> + <span class="number">0.015</span> * C_1ave * T;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>console.log(&quot;SH&quot;, SH);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> dTheta = <span class="number">30</span> * Math.exp(-<span class="number">1</span> * Math.pow((hDiff - <span class="number">275</span> ) / <span class="number">25</span>, <span class="number">2</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>console.log(&quot;dTheta&quot;, dTheta);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> RC = <span class="number">2</span> * Math.sqrt(Math.pow(C_1ave, <span class="number">7</span>) / (Math.pow(C_1ave, <span class="number">7</span>) + Math.pow(<span class="number">25</span>, <span class="number">7</span>)));</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>console.log(&quot;RC&quot;, RC);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> RT = <span class="number">0</span> - Math.sin(root.helper.math.toRad( <span class="number">2</span> * dTheta)) * RC;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>console.log(&quot;RT&quot;, RT);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> dkL = deltaL / (k_L * SL);
            <span class="keyword">var</span> dkC = deltaC / (k_C * SC);
            <span class="keyword">var</span> dkH = deltaH / (k_H * SH);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>console.log(&quot;dkL&quot;, dkL);
console.log(&quot;dkC&quot;, dkC);
console.log(&quot;dkH&quot;, dkH);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> CIEDE2000 = Math.sqrt(Math.pow(dkL, <span class="number">2</span>) + Math.pow(dkC, <span class="number">2</span>) + Math.pow(dkH, <span class="number">2</span>) + RT * dkC * dkH );</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>console.log(&quot;CIEDE2000&quot;, CIEDE2000);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span> CIEDE2000;

        },

        toArray: <span class="keyword">function</span>() {
            <span class="keyword">return</span> [<span class="keyword">this</span>.L(), <span class="keyword">this</span>.a(), <span class="keyword">this</span>.b()];
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>plot the Lab-Values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toString: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="string">'L: '</span> + <span class="keyword">this</span>.L() + <span class="string">', a: '</span> + <span class="keyword">this</span>.a() + <span class="string">', b: '</span> + <span class="keyword">this</span>.b();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>shorthand for toString</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        print: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>.toString();
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3>to work in the CMYK colorspace</h3>
<p>use it with <code>colorLab.CMYK</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">this</span>.CMYK = {
        init: <span class="keyword">function</span>(C, M, Y, K) {
            root._CMYK = {C:<span class="number">0</span>,M:<span class="number">0</span>,Y:<span class="number">0</span>,K:<span class="number">0</span>};
            <span class="keyword">this</span>.C(C);
            <span class="keyword">this</span>.M(M);
            <span class="keyword">this</span>.Y(Y);
            <span class="keyword">this</span>.K(K);
        },

        C: <span class="keyword">function</span>(C) {
            <span class="keyword">if</span> (C === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CMYK.C;
            } <span class="keyword">else</span> {
                root._CMYK.C = C;
            }
        },
        M: <span class="keyword">function</span>(M) {
            <span class="keyword">if</span> (M === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CMYK.M;
            } <span class="keyword">else</span> {
                root._CMYK.M = M;
            }
        },
        Y: <span class="keyword">function</span>(Y) {
            <span class="keyword">if</span> (Y === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CMYK.Y;
            } <span class="keyword">else</span> {
                root._CMYK.Y = Y;
            }
        },
        K: <span class="keyword">function</span>(K) {
            <span class="keyword">if</span> (K === <span class="literal">undefined</span>) {
                <span class="keyword">return</span> root._CMYK.K;
            } <span class="keyword">else</span> {
                root._CMYK.K = K;
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>add value to pint like <code>add({x:1,y:2})</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        add: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a + b;});
        },
        sub: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a - b;});
        },
        mul: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a * b;});
        },
        div: <span class="keyword">function</span>(other) {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(other, <span class="keyword">function</span>(a, b) {<span class="keyword">return</span> a / b;});
        },
        floor: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(<span class="literal">null</span>, <span class="keyword">function</span>(a) {<span class="keyword">return</span> Math.floor(a);});
        },
        round: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>._fnTemplate(<span class="literal">null</span>, <span class="keyword">function</span>(a) {<span class="keyword">return</span> Math.round(a);});
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h4">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h4>general function template</h4>
<p>this is the general template to run the generalized functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _fnTemplate: <span class="keyword">function</span>(other, op) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>run function without an additional numeric imput like <code>add(2)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (<span class="keyword">typeof</span>(other) === <span class="string">'number'</span>) {
                <span class="keyword">this</span>.C( op(<span class="keyword">this</span>.C(), other) );
                <span class="keyword">this</span>.M( op(<span class="keyword">this</span>.M(), other) );
                <span class="keyword">this</span>.Y( op(<span class="keyword">this</span>.Y(), other) );
                <span class="keyword">this</span>.K( op(<span class="keyword">this</span>.K(), other) );
                <span class="keyword">return</span> <span class="keyword">this</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>run function without an additional imput like <code>round()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (other === <span class="literal">null</span>) {
                <span class="keyword">this</span>.C( op(<span class="keyword">this</span>.C()) );
                <span class="keyword">this</span>.M( op(<span class="keyword">this</span>.M()) );
                <span class="keyword">this</span>.Y( op(<span class="keyword">this</span>.Y()) );
                <span class="keyword">this</span>.K( op(<span class="keyword">this</span>.K()) );
                <span class="keyword">return</span> <span class="keyword">this</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>run function without an additional imput of type colorLab or objects <code>add({L:2,a:3,b:2})</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (other.CMYK === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.C( op(<span class="keyword">this</span>.C(), other.C) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.C( op(<span class="keyword">this</span>.C(), other.CMYK.C()) );
            }

            <span class="keyword">if</span> (other.CMYK === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.M( op(<span class="keyword">this</span>.M(), other.M) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.M( op(<span class="keyword">this</span>.M(), other.CMYK.M()) );
            }

            <span class="keyword">if</span> (other.CMYK === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.Y( op(<span class="keyword">this</span>.Y(), other.Y) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.Y( op(<span class="keyword">this</span>.Y(), other.CMYK.Y()) );
            }

            <span class="keyword">if</span> (other.CMYK === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.K( op(<span class="keyword">this</span>.K(), other.K) );
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.K( op(<span class="keyword">this</span>.K(), other.CMYK.K()) );
            }


            <span class="keyword">return</span> <span class="keyword">this</span>;
        },

        toArray: <span class="keyword">function</span>() {
            <span class="keyword">return</span> [<span class="keyword">this</span>.C(), <span class="keyword">this</span>.M(), <span class="keyword">this</span>.Y(), <span class="keyword">this</span>.K()];
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>plot the Color-Values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toString: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="string">'C: '</span> + <span class="keyword">this</span>.C() + <span class="string">', M: '</span> + <span class="keyword">this</span>.M() + <span class="string">', Y: '</span> + <span class="keyword">this</span>.Y() + <span class="string">', K: '</span> + <span class="keyword">this</span>.K();
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>shorthand for toString</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        print: <span class="keyword">function</span>() {
            <span class="keyword">return</span> <span class="keyword">this</span>.toString();
        }
    };



    <span class="keyword">if</span> (space !== <span class="literal">undefined</span>) {

        <span class="keyword">switch</span> (space)
        {
        <span class="keyword">case</span> <span class="string">'CIELAB'</span>:
            <span class="keyword">this</span>._currentSpace = space;

            <span class="keyword">if</span> (values === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.CIELAB.init(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.CIELAB.init(values[<span class="number">0</span>], values[<span class="number">1</span>], values[<span class="number">2</span>]);
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string">'CMYK'</span>:
            <span class="keyword">this</span>._currentSpace = space;

            <span class="keyword">if</span> (values === <span class="literal">undefined</span>) {
                <span class="keyword">this</span>.CMYK.init(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);
            } <span class="keyword">else</span> {
                <span class="keyword">this</span>.CMYK.init(values[<span class="number">0</span>], values[<span class="number">1</span>], values[<span class="number">2</span>], values[<span class="number">3</span>]);
            }
            <span class="keyword">break</span>;
        <span class="keyword">default</span>:
            <span class="keyword">throw</span> {
                type:       <span class="string">"implementation"</span>,
                message:     <span class="string">"at the moment you can just use CIELAB-Colorspce."</span>
            };
        }
    }



});






<span class="comment">/*


github-page &gt;&gt; http://ricostacruz.com/flatdoc/</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><a href="http://jsperf.com/linear-interpolation/5">http://jsperf.com/linear-interpolation/5</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>function linearInterpolation(min, max, k) {
    return min + (max - min) * k;
}

http://bl.ocks.org/mbostock/4281513
http://bl.ocks.org/mbostock/3014589
dont mix colors in lab!! mix in xyz!!!

 */</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>D65</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>colorLab.XYZ2RGBMtx = {

    CIED65 : {
        AdobeRGB : {name: <span class="string">'Adobe RGB (1998)'</span>, m1: <span class="number">2.04148</span>, m2:-<span class="number">0.969258</span>, m3:<span class="number">0.0134455</span>, m4:-<span class="number">0.564977</span>, m5:<span class="number">1.87599</span>, m6:-<span class="number">0.118373</span>, m7:-<span class="number">0.344713</span>, m8:<span class="number">0.0415557</span>, m9:<span class="number">1.01527</span>, gamma:<span class="number">2.2</span>},
        AppleRGB : {name: <span class="string">'Apple RGB'</span>, m1: <span class="number">2.95176</span>, m2:-<span class="number">1.0851</span>, m3:<span class="number">0.0854804</span>, m4:-<span class="number">1.28951</span>, m5:<span class="number">1.99084</span>, m6:-<span class="number">0.269456</span>, m7:-<span class="number">0.47388</span>, m8:<span class="number">0.0372023</span>, m9:<span class="number">1.09113</span>, gamma:<span class="number">1.8</span>},
        ECIRGB   : {name: <span class="string">'ECI RGB'</span>, m1: <span class="number">1.78276</span>, m2:-<span class="number">0.959362</span>, m3:<span class="number">0.0859318</span>, m4:-<span class="number">0.496985</span>, m5:<span class="number">1.9478</span>, m6:-<span class="number">0.174467</span>, m7:-<span class="number">0.26901</span>, m8:-<span class="number">0.0275807</span>, m9:<span class="number">1.32283</span>, gamma:<span class="number">1.8</span>},
        sRGB     : {name: <span class="string">'sRGB'</span>, m1: <span class="number">3.24071</span>, m2:-<span class="number">0.969258</span>, m3:<span class="number">0.0556352</span>, m4:-<span class="number">1.53726</span>, m5:<span class="number">1.87599</span>, m6:-<span class="number">0.203996</span>, m7:-<span class="number">0.498571</span>, m8:<span class="number">0.0415557</span>, m9:<span class="number">1.05707</span>, gamma:<span class="number">2.4</span>}
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Relative spectral power distribution of CIE Standard Illuminant D65
Source: <a href="http://www.cie.co.at/publ/abst/datatables15_2004/CIE_sel_colorimetric_tables.xls">http://www.cie.co.at/publ/abst/datatables15_2004/CIE_sel_colorimetric_tables.xls</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>colorLab.illuminant = {
    CIED65 : [
        {nm: <span class="number">300</span>, power: <span class="number">0.0341</span>},
        {nm: <span class="number">305</span>, power: <span class="number">1.6643</span>},
        {nm: <span class="number">310</span>, power: <span class="number">3.2945</span>},
        {nm: <span class="number">315</span>, power: <span class="number">11.7652</span>},
        {nm: <span class="number">320</span>, power: <span class="number">20.236</span>},
        {nm: <span class="number">325</span>, power: <span class="number">28.6447</span>},
        {nm: <span class="number">330</span>, power: <span class="number">37.0535</span>},
        {nm: <span class="number">335</span>, power: <span class="number">38.5011</span>},
        {nm: <span class="number">340</span>, power: <span class="number">39.9488</span>},
        {nm: <span class="number">345</span>, power: <span class="number">42.4302</span>},
        {nm: <span class="number">350</span>, power: <span class="number">44.9117</span>},
        {nm: <span class="number">355</span>, power: <span class="number">45.775</span>},
        {nm: <span class="number">360</span>, power: <span class="number">46.6383</span>},
        {nm: <span class="number">365</span>, power: <span class="number">49.3637</span>},
        {nm: <span class="number">370</span>, power: <span class="number">52.0891</span>},
        {nm: <span class="number">375</span>, power: <span class="number">51.0323</span>},
        {nm: <span class="number">380</span>, power: <span class="number">49.9755</span>},
        {nm: <span class="number">385</span>, power: <span class="number">52.3118</span>},
        {nm: <span class="number">390</span>, power: <span class="number">54.6482</span>},
        {nm: <span class="number">395</span>, power: <span class="number">68.7015</span>},
        {nm: <span class="number">400</span>, power: <span class="number">82.7549</span>},
        {nm: <span class="number">405</span>, power: <span class="number">87.1204</span>},
        {nm: <span class="number">410</span>, power: <span class="number">91.486</span>},
        {nm: <span class="number">415</span>, power: <span class="number">92.4589</span>},
        {nm: <span class="number">420</span>, power: <span class="number">93.4318</span>},
        {nm: <span class="number">425</span>, power: <span class="number">90.057</span>},
        {nm: <span class="number">430</span>, power: <span class="number">86.6823</span>},
        {nm: <span class="number">435</span>, power: <span class="number">95.7736</span>},
        {nm: <span class="number">440</span>, power: <span class="number">104.865</span>},
        {nm: <span class="number">445</span>, power: <span class="number">110.936</span>},
        {nm: <span class="number">450</span>, power: <span class="number">117.008</span>},
        {nm: <span class="number">455</span>, power: <span class="number">117.41</span>},
        {nm: <span class="number">460</span>, power: <span class="number">117.812</span>},
        {nm: <span class="number">465</span>, power: <span class="number">116.336</span>},
        {nm: <span class="number">470</span>, power: <span class="number">114.861</span>},
        {nm: <span class="number">475</span>, power: <span class="number">115.392</span>},
        {nm: <span class="number">480</span>, power: <span class="number">115.923</span>},
        {nm: <span class="number">485</span>, power: <span class="number">112.367</span>},
        {nm: <span class="number">490</span>, power: <span class="number">108.811</span>},
        {nm: <span class="number">495</span>, power: <span class="number">109.082</span>},
        {nm: <span class="number">500</span>, power: <span class="number">109.354</span>},
        {nm: <span class="number">505</span>, power: <span class="number">108.578</span>},
        {nm: <span class="number">510</span>, power: <span class="number">107.802</span>},
        {nm: <span class="number">515</span>, power: <span class="number">106.296</span>},
        {nm: <span class="number">520</span>, power: <span class="number">104.79</span>},
        {nm: <span class="number">525</span>, power: <span class="number">106.239</span>},
        {nm: <span class="number">530</span>, power: <span class="number">107.689</span>},
        {nm: <span class="number">535</span>, power: <span class="number">106.047</span>},
        {nm: <span class="number">540</span>, power: <span class="number">104.405</span>},
        {nm: <span class="number">545</span>, power: <span class="number">104.225</span>},
        {nm: <span class="number">550</span>, power: <span class="number">104.046</span>},
        {nm: <span class="number">555</span>, power: <span class="number">102.023</span>},
        {nm: <span class="number">560</span>, power: <span class="number">100</span>},
        {nm: <span class="number">565</span>, power: <span class="number">98.1671</span>},
        {nm: <span class="number">570</span>, power: <span class="number">96.3342</span>},
        {nm: <span class="number">575</span>, power: <span class="number">96.0611</span>},
        {nm: <span class="number">580</span>, power: <span class="number">95.788</span>},
        {nm: <span class="number">585</span>, power: <span class="number">92.2368</span>},
        {nm: <span class="number">590</span>, power: <span class="number">88.6856</span>},
        {nm: <span class="number">595</span>, power: <span class="number">89.3459</span>},
        {nm: <span class="number">600</span>, power: <span class="number">90.0062</span>},
        {nm: <span class="number">605</span>, power: <span class="number">89.8026</span>},
        {nm: <span class="number">610</span>, power: <span class="number">89.5991</span>},
        {nm: <span class="number">615</span>, power: <span class="number">88.6489</span>},
        {nm: <span class="number">620</span>, power: <span class="number">87.6987</span>},
        {nm: <span class="number">625</span>, power: <span class="number">85.4936</span>},
        {nm: <span class="number">630</span>, power: <span class="number">83.2886</span>},
        {nm: <span class="number">635</span>, power: <span class="number">83.4939</span>},
        {nm: <span class="number">640</span>, power: <span class="number">83.6992</span>},
        {nm: <span class="number">645</span>, power: <span class="number">81.863</span>},
        {nm: <span class="number">650</span>, power: <span class="number">80.0268</span>},
        {nm: <span class="number">655</span>, power: <span class="number">80.1207</span>},
        {nm: <span class="number">660</span>, power: <span class="number">80.2146</span>},
        {nm: <span class="number">665</span>, power: <span class="number">81.2462</span>},
        {nm: <span class="number">670</span>, power: <span class="number">82.2778</span>},
        {nm: <span class="number">675</span>, power: <span class="number">80.281</span>},
        {nm: <span class="number">680</span>, power: <span class="number">78.2842</span>},
        {nm: <span class="number">685</span>, power: <span class="number">74.0027</span>},
        {nm: <span class="number">690</span>, power: <span class="number">69.7213</span>},
        {nm: <span class="number">695</span>, power: <span class="number">70.6652</span>},
        {nm: <span class="number">700</span>, power: <span class="number">71.6091</span>},
        {nm: <span class="number">705</span>, power: <span class="number">72.979</span>},
        {nm: <span class="number">710</span>, power: <span class="number">74.349</span>},
        {nm: <span class="number">715</span>, power: <span class="number">67.9765</span>},
        {nm: <span class="number">720</span>, power: <span class="number">61.604</span>},
        {nm: <span class="number">725</span>, power: <span class="number">65.7448</span>},
        {nm: <span class="number">730</span>, power: <span class="number">69.8856</span>},
        {nm: <span class="number">735</span>, power: <span class="number">72.4863</span>},
        {nm: <span class="number">740</span>, power: <span class="number">75.087</span>},
        {nm: <span class="number">745</span>, power: <span class="number">69.3398</span>},
        {nm: <span class="number">750</span>, power: <span class="number">63.5927</span>},
        {nm: <span class="number">755</span>, power: <span class="number">55.0054</span>},
        {nm: <span class="number">760</span>, power: <span class="number">46.4182</span>},
        {nm: <span class="number">765</span>, power: <span class="number">56.6118</span>},
        {nm: <span class="number">770</span>, power: <span class="number">66.8054</span>},
        {nm: <span class="number">775</span>, power: <span class="number">65.0941</span>},
        {nm: <span class="number">780</span>, power: <span class="number">63.3828</span>},
        {nm: <span class="number">785</span>, power: <span class="number">63.8434</span>},
        {nm: <span class="number">790</span>, power: <span class="number">64.304</span>},
        {nm: <span class="number">795</span>, power: <span class="number">61.8779</span>},
        {nm: <span class="number">800</span>, power: <span class="number">59.4519</span>},
        {nm: <span class="number">805</span>, power: <span class="number">55.7054</span>},
        {nm: <span class="number">810</span>, power: <span class="number">51.959</span>},
        {nm: <span class="number">815</span>, power: <span class="number">54.6998</span>},
        {nm: <span class="number">820</span>, power: <span class="number">57.4406</span>},
        {nm: <span class="number">825</span>, power: <span class="number">58.8765</span>},
        {nm: <span class="number">830</span>, power: <span class="number">60.3125</span>}
    ],
    D :  [
        {nm: <span class="number">340</span>, power: <span class="number">17.92</span>},
        {nm: <span class="number">350</span>, power: <span class="number">20.98</span>},
        {nm: <span class="number">360</span>, power: <span class="number">23.91</span>},
        {nm: <span class="number">370</span>, power: <span class="number">25.89</span>},
        {nm: <span class="number">380</span>, power: <span class="number">24.45</span>},
        {nm: <span class="number">390</span>, power: <span class="number">29.83</span>},
        {nm: <span class="number">400</span>, power: <span class="number">49.25</span>},
        {nm: <span class="number">410</span>, power: <span class="number">56.45</span>},
        {nm: <span class="number">420</span>, power: <span class="number">59.97</span>},
        {nm: <span class="number">430</span>, power: <span class="number">57.76</span>},
        {nm: <span class="number">440</span>, power: <span class="number">74.77</span>},
        {nm: <span class="number">450</span>, power: <span class="number">87.19</span>},
        {nm: <span class="number">460</span>, power: <span class="number">90.56</span>},
        {nm: <span class="number">470</span>, power: <span class="number">91.32</span>},
        {nm: <span class="number">480</span>, power: <span class="number">95.07</span>},
        {nm: <span class="number">490</span>, power: <span class="number">91.93</span>},
        {nm: <span class="number">500</span>, power: <span class="number">95.70</span>},
        {nm: <span class="number">510</span>, power: <span class="number">96.59</span>},
        {nm: <span class="number">520</span>, power: <span class="number">97.11</span>},
        {nm: <span class="number">530</span>, power: <span class="number">102.09</span>},
        {nm: <span class="number">540</span>, power: <span class="number">100.75</span>},
        {nm: <span class="number">550</span>, power: <span class="number">102.31</span>},
        {nm: <span class="number">560</span>, power: <span class="number">100.00</span>},
        {nm: <span class="number">570</span>, power: <span class="number">97.74</span>},
        {nm: <span class="number">580</span>, power: <span class="number">98.92</span>},
        {nm: <span class="number">590</span>, power: <span class="number">93.51</span>},
        {nm: <span class="number">600</span>, power: <span class="number">97.71</span>},
        {nm: <span class="number">610</span>, power: <span class="number">99.29</span>},
        {nm: <span class="number">620</span>, power: <span class="number">99.07</span>},
        {nm: <span class="number">630</span>, power: <span class="number">95.75</span>},
        {nm: <span class="number">640</span>, power: <span class="number">98.90</span>},
        {nm: <span class="number">650</span>, power: <span class="number">95.71</span>},
        {nm: <span class="number">660</span>, power: <span class="number">98.24</span>},
        {nm: <span class="number">670</span>, power: <span class="number">103.06</span>},
        {nm: <span class="number">680</span>, power: <span class="number">99.19</span>},
        {nm: <span class="number">690</span>, power: <span class="number">87.43</span>},
        {nm: <span class="number">700</span>, power: <span class="number">91.66</span>},
        {nm: <span class="number">710</span>, power: <span class="number">92.94</span>},
        {nm: <span class="number">720</span>, power: <span class="number">76.89</span>},
        {nm: <span class="number">730</span>, power: <span class="number">86.56</span>},
        {nm: <span class="number">740</span>, power: <span class="number">92.63</span>},
        {nm: <span class="number">750</span>, power: <span class="number">78.27</span>},
        {nm: <span class="number">760</span>, power: <span class="number">57.72</span>},
        {nm: <span class="number">770</span>, power: <span class="number">82.97</span>},
        {nm: <span class="number">780</span>, power: <span class="number">78.31</span>},
        {nm: <span class="number">790</span>, power: <span class="number">79.59</span>},
        {nm: <span class="number">800</span>, power: <span class="number">73.44</span>},
        {nm: <span class="number">810</span>, power: <span class="number">63.95</span>},
        {nm: <span class="number">820</span>, power: <span class="number">70.81</span>},
        {nm: <span class="number">830</span>, power: <span class="number">74.48</span>}
    ]
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>1931 2° CIE Standard Colorimetric Observer Data
1964 10 °CIE Standard Colorimetric Observer Data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>colorLab.observer = {
    CIE1964 : [
        {nm: <span class="number">380</span>, xyz: [<span class="number">0.00016</span>,<span class="number">0.000017</span>,<span class="number">0.000705</span>]},
        {nm: <span class="number">385</span>, xyz: [<span class="number">0.000662</span>,<span class="number">0.000072</span>,<span class="number">0.002928</span>]},
        {nm: <span class="number">390</span>, xyz: [<span class="number">0.002362</span>,<span class="number">0.000253</span>,<span class="number">0.010482</span>]},
        {nm: <span class="number">395</span>, xyz: [<span class="number">0.007242</span>,<span class="number">0.000769</span>,<span class="number">0.032344</span>]},
        {nm: <span class="number">400</span>, xyz: [<span class="number">0.01911</span>,<span class="number">0.002004</span>,<span class="number">0.086011</span>]},
        {nm: <span class="number">405</span>, xyz: [<span class="number">0.0434</span>,<span class="number">0.004509</span>,<span class="number">0.19712</span>]},
        {nm: <span class="number">410</span>, xyz: [<span class="number">0.084736</span>,<span class="number">0.008756</span>,<span class="number">0.389366</span>]},
        {nm: <span class="number">415</span>, xyz: [<span class="number">0.140638</span>,<span class="number">0.014456</span>,<span class="number">0.65676</span>]},
        {nm: <span class="number">420</span>, xyz: [<span class="number">0.204492</span>,<span class="number">0.021391</span>,<span class="number">0.972542</span>]},
        {nm: <span class="number">425</span>, xyz: [<span class="number">0.264737</span>,<span class="number">0.029497</span>,<span class="number">1.2825</span>]},
        {nm: <span class="number">430</span>, xyz: [<span class="number">0.314679</span>,<span class="number">0.038676</span>,<span class="number">1.55348</span>]},
        {nm: <span class="number">435</span>, xyz: [<span class="number">0.357719</span>,<span class="number">0.049602</span>,<span class="number">1.7985</span>]},
        {nm: <span class="number">440</span>, xyz: [<span class="number">0.383734</span>,<span class="number">0.062077</span>,<span class="number">1.96728</span>]},
        {nm: <span class="number">445</span>, xyz: [<span class="number">0.386726</span>,<span class="number">0.074704</span>,<span class="number">2.0273</span>]},
        {nm: <span class="number">450</span>, xyz: [<span class="number">0.370702</span>,<span class="number">0.089456</span>,<span class="number">1.9948</span>]},
        {nm: <span class="number">455</span>, xyz: [<span class="number">0.342957</span>,<span class="number">0.106256</span>,<span class="number">1.9007</span>]},
        {nm: <span class="number">460</span>, xyz: [<span class="number">0.302273</span>,<span class="number">0.128201</span>,<span class="number">1.74537</span>]},
        {nm: <span class="number">465</span>, xyz: [<span class="number">0.254085</span>,<span class="number">0.152761</span>,<span class="number">1.5549</span>]},
        {nm: <span class="number">470</span>, xyz: [<span class="number">0.195618</span>,<span class="number">0.18519</span>,<span class="number">1.31756</span>]},
        {nm: <span class="number">475</span>, xyz: [<span class="number">0.132349</span>,<span class="number">0.21994</span>,<span class="number">1.0302</span>]},
        {nm: <span class="number">480</span>, xyz: [<span class="number">0.080507</span>,<span class="number">0.253589</span>,<span class="number">0.772125</span>]},
        {nm: <span class="number">485</span>, xyz: [<span class="number">0.041072</span>,<span class="number">0.297665</span>,<span class="number">0.57006</span>]},
        {nm: <span class="number">490</span>, xyz: [<span class="number">0.016172</span>,<span class="number">0.339133</span>,<span class="number">0.415254</span>]},
        {nm: <span class="number">495</span>, xyz: [<span class="number">0.005132</span>,<span class="number">0.395379</span>,<span class="number">0.302356</span>]},
        {nm: <span class="number">500</span>, xyz: [<span class="number">0.003816</span>,<span class="number">0.460777</span>,<span class="number">0.218502</span>]},
        {nm: <span class="number">505</span>, xyz: [<span class="number">0.015444</span>,<span class="number">0.53136</span>,<span class="number">0.159249</span>]},
        {nm: <span class="number">510</span>, xyz: [<span class="number">0.037465</span>,<span class="number">0.606741</span>,<span class="number">0.112044</span>]},
        {nm: <span class="number">515</span>, xyz: [<span class="number">0.071358</span>,<span class="number">0.68566</span>,<span class="number">0.082248</span>]},
        {nm: <span class="number">520</span>, xyz: [<span class="number">0.117749</span>,<span class="number">0.761757</span>,<span class="number">0.060709</span>]},
        {nm: <span class="number">525</span>, xyz: [<span class="number">0.172953</span>,<span class="number">0.82333</span>,<span class="number">0.04305</span>]},
        {nm: <span class="number">530</span>, xyz: [<span class="number">0.236491</span>,<span class="number">0.875211</span>,<span class="number">0.030451</span>]},
        {nm: <span class="number">535</span>, xyz: [<span class="number">0.304213</span>,<span class="number">0.92381</span>,<span class="number">0.020584</span>]},
        {nm: <span class="number">540</span>, xyz: [<span class="number">0.376772</span>,<span class="number">0.961988</span>,<span class="number">0.013676</span>]},
        {nm: <span class="number">545</span>, xyz: [<span class="number">0.451584</span>,<span class="number">0.9822</span>,<span class="number">0.007918</span>]},
        {nm: <span class="number">550</span>, xyz: [<span class="number">0.529826</span>,<span class="number">0.991761</span>,<span class="number">0.003988</span>]},
        {nm: <span class="number">555</span>, xyz: [<span class="number">0.616053</span>,<span class="number">0.99911</span>,<span class="number">0.001091</span>]},
        {nm: <span class="number">560</span>, xyz: [<span class="number">0.705224</span>,<span class="number">0.99734</span>,<span class="number">0</span>]},
        {nm: <span class="number">565</span>, xyz: [<span class="number">0.793832</span>,<span class="number">0.98238</span>,<span class="number">0</span>]},
        {nm: <span class="number">570</span>, xyz: [<span class="number">0.878655</span>,<span class="number">0.955552</span>,<span class="number">0</span>]},
        {nm: <span class="number">575</span>, xyz: [<span class="number">0.951162</span>,<span class="number">0.915175</span>,<span class="number">0</span>]},
        {nm: <span class="number">580</span>, xyz: [<span class="number">1.01416</span>,<span class="number">0.868934</span>,<span class="number">0</span>]},
        {nm: <span class="number">585</span>, xyz: [<span class="number">1.0743</span>,<span class="number">0.825623</span>,<span class="number">0</span>]},
        {nm: <span class="number">590</span>, xyz: [<span class="number">1.11852</span>,<span class="number">0.777405</span>,<span class="number">0</span>]},
        {nm: <span class="number">595</span>, xyz: [<span class="number">1.1343</span>,<span class="number">0.720353</span>,<span class="number">0</span>]},
        {nm: <span class="number">600</span>, xyz: [<span class="number">1.12399</span>,<span class="number">0.658341</span>,<span class="number">0</span>]},
        {nm: <span class="number">605</span>, xyz: [<span class="number">1.0891</span>,<span class="number">0.593878</span>,<span class="number">0</span>]},
        {nm: <span class="number">610</span>, xyz: [<span class="number">1.03048</span>,<span class="number">0.527963</span>,<span class="number">0</span>]},
        {nm: <span class="number">615</span>, xyz: [<span class="number">0.95074</span>,<span class="number">0.461834</span>,<span class="number">0</span>]},
        {nm: <span class="number">620</span>, xyz: [<span class="number">0.856297</span>,<span class="number">0.398057</span>,<span class="number">0</span>]},
        {nm: <span class="number">625</span>, xyz: [<span class="number">0.75493</span>,<span class="number">0.339554</span>,<span class="number">0</span>]},
        {nm: <span class="number">630</span>, xyz: [<span class="number">0.647467</span>,<span class="number">0.283493</span>,<span class="number">0</span>]},
        {nm: <span class="number">635</span>, xyz: [<span class="number">0.53511</span>,<span class="number">0.228254</span>,<span class="number">0</span>]},
        {nm: <span class="number">640</span>, xyz: [<span class="number">0.431567</span>,<span class="number">0.179828</span>,<span class="number">0</span>]},
        {nm: <span class="number">645</span>, xyz: [<span class="number">0.34369</span>,<span class="number">0.140211</span>,<span class="number">0</span>]},
        {nm: <span class="number">650</span>, xyz: [<span class="number">0.268329</span>,<span class="number">0.107633</span>,<span class="number">0</span>]},
        {nm: <span class="number">655</span>, xyz: [<span class="number">0.2043</span>,<span class="number">0.081187</span>,<span class="number">0</span>]},
        {nm: <span class="number">660</span>, xyz: [<span class="number">0.152568</span>,<span class="number">0.060281</span>,<span class="number">0</span>]},
        {nm: <span class="number">665</span>, xyz: [<span class="number">0.11221</span>,<span class="number">0.044096</span>,<span class="number">0</span>]},
        {nm: <span class="number">670</span>, xyz: [<span class="number">0.081261</span>,<span class="number">0.0318</span>,<span class="number">0</span>]},
        {nm: <span class="number">675</span>, xyz: [<span class="number">0.05793</span>,<span class="number">0.022602</span>,<span class="number">0</span>]},
        {nm: <span class="number">680</span>, xyz: [<span class="number">0.040851</span>,<span class="number">0.015905</span>,<span class="number">0</span>]},
        {nm: <span class="number">685</span>, xyz: [<span class="number">0.028623</span>,<span class="number">0.01113</span>,<span class="number">0</span>]},
        {nm: <span class="number">690</span>, xyz: [<span class="number">0.019941</span>,<span class="number">0.007749</span>,<span class="number">0</span>]},
        {nm: <span class="number">695</span>, xyz: [<span class="number">0.013842</span>,<span class="number">0.005375</span>,<span class="number">0</span>]},
        {nm: <span class="number">700</span>, xyz: [<span class="number">0.009577</span>,<span class="number">0.003718</span>,<span class="number">0</span>]},
        {nm: <span class="number">705</span>, xyz: [<span class="number">0.006605</span>,<span class="number">0.002565</span>,<span class="number">0</span>]},
        {nm: <span class="number">710</span>, xyz: [<span class="number">0.004553</span>,<span class="number">0.001768</span>,<span class="number">0</span>]},
        {nm: <span class="number">715</span>, xyz: [<span class="number">0.003145</span>,<span class="number">0.001222</span>,<span class="number">0</span>]},
        {nm: <span class="number">720</span>, xyz: [<span class="number">0.002175</span>,<span class="number">0.000846</span>,<span class="number">0</span>]},
        {nm: <span class="number">725</span>, xyz: [<span class="number">0.001506</span>,<span class="number">0.000586</span>,<span class="number">0</span>]},
        {nm: <span class="number">730</span>, xyz: [<span class="number">0.001045</span>,<span class="number">0.000407</span>,<span class="number">0</span>]},
        {nm: <span class="number">735</span>, xyz: [<span class="number">0.000727</span>,<span class="number">0.000284</span>,<span class="number">0</span>]},
        {nm: <span class="number">740</span>, xyz: [<span class="number">0.000508</span>,<span class="number">0.000199</span>,<span class="number">0</span>]},
        {nm: <span class="number">745</span>, xyz: [<span class="number">0.000356</span>,<span class="number">0.00014</span>,<span class="number">0</span>]},
        {nm: <span class="number">750</span>, xyz: [<span class="number">0.000251</span>,<span class="number">0.000098</span>,<span class="number">0</span>]},
        {nm: <span class="number">755</span>, xyz: [<span class="number">0.000178</span>,<span class="number">0.00007</span>,<span class="number">0</span>]},
        {nm: <span class="number">760</span>, xyz: [<span class="number">0.000126</span>,<span class="number">0.00005</span>,<span class="number">0</span>]},
        {nm: <span class="number">765</span>, xyz: [<span class="number">0.00009</span>,<span class="number">0.000036</span>,<span class="number">0</span>]},
        {nm: <span class="number">770</span>, xyz: [<span class="number">0.000065</span>,<span class="number">0.000025</span>,<span class="number">0</span>]},
        {nm: <span class="number">775</span>, xyz: [<span class="number">0.000046</span>,<span class="number">0.000018</span>,<span class="number">0</span>]},
        {nm: <span class="number">780</span>, xyz: [<span class="number">0.000033</span>,<span class="number">0.000013</span>,<span class="number">0</span>]}
    ],
    CIE1931 : [
        {nm: <span class="number">380</span>, xyz: [<span class="number">0.001368</span>,<span class="number">0.000039</span>,<span class="number">0.00645</span>]},
        {nm: <span class="number">385</span>, xyz: [<span class="number">0.002236</span>,<span class="number">0.000064</span>,<span class="number">0.01055</span>]},
        {nm: <span class="number">390</span>, xyz: [<span class="number">0.004243</span>,<span class="number">0.00012</span>,<span class="number">0.02005</span>]},
        {nm: <span class="number">395</span>, xyz: [<span class="number">0.00765</span>,<span class="number">0.000217</span>,<span class="number">0.03621</span>]},
        {nm: <span class="number">400</span>, xyz: [<span class="number">0.01431</span>,<span class="number">0.000396</span>,<span class="number">0.06785</span>]},
        {nm: <span class="number">405</span>, xyz: [<span class="number">0.02319</span>,<span class="number">0.00064</span>,<span class="number">0.1102</span>]},
        {nm: <span class="number">410</span>, xyz: [<span class="number">0.04351</span>,<span class="number">0.00121</span>,<span class="number">0.2074</span>]},
        {nm: <span class="number">415</span>, xyz: [<span class="number">0.07763</span>,<span class="number">0.00218</span>,<span class="number">0.3713</span>]},
        {nm: <span class="number">420</span>, xyz: [<span class="number">0.13438</span>,<span class="number">0.004</span>,<span class="number">0.6456</span>]},
        {nm: <span class="number">425</span>, xyz: [<span class="number">0.21477</span>,<span class="number">0.0073</span>,<span class="number">1.03905</span>]},
        {nm: <span class="number">430</span>, xyz: [<span class="number">0.2839</span>,<span class="number">0.0116</span>,<span class="number">1.3856</span>]},
        {nm: <span class="number">435</span>, xyz: [<span class="number">0.3285</span>,<span class="number">0.01684</span>,<span class="number">1.62296</span>]},
        {nm: <span class="number">440</span>, xyz: [<span class="number">0.34828</span>,<span class="number">0.023</span>,<span class="number">1.74706</span>]},
        {nm: <span class="number">445</span>, xyz: [<span class="number">0.34806</span>,<span class="number">0.0298</span>,<span class="number">1.7826</span>]},
        {nm: <span class="number">450</span>, xyz: [<span class="number">0.3362</span>,<span class="number">0.038</span>,<span class="number">1.77211</span>]},
        {nm: <span class="number">455</span>, xyz: [<span class="number">0.3187</span>,<span class="number">0.048</span>,<span class="number">1.7441</span>]},
        {nm: <span class="number">460</span>, xyz: [<span class="number">0.2908</span>,<span class="number">0.06</span>,<span class="number">1.6692</span>]},
        {nm: <span class="number">465</span>, xyz: [<span class="number">0.2511</span>,<span class="number">0.0739</span>,<span class="number">1.5281</span>]},
        {nm: <span class="number">470</span>, xyz: [<span class="number">0.19536</span>,<span class="number">0.09098</span>,<span class="number">1.28764</span>]},
        {nm: <span class="number">475</span>, xyz: [<span class="number">0.1421</span>,<span class="number">0.1126</span>,<span class="number">1.0419</span>]},
        {nm: <span class="number">480</span>, xyz: [<span class="number">0.09564</span>,<span class="number">0.13902</span>,<span class="number">0.81295</span>]},
        {nm: <span class="number">485</span>, xyz: [<span class="number">0.05795</span>,<span class="number">0.1693</span>,<span class="number">0.6162</span>]},
        {nm: <span class="number">490</span>, xyz: [<span class="number">0.03201</span>,<span class="number">0.20802</span>,<span class="number">0.46518</span>]},
        {nm: <span class="number">495</span>, xyz: [<span class="number">0.0147</span>,<span class="number">0.2586</span>,<span class="number">0.3533</span>]},
        {nm: <span class="number">500</span>, xyz: [<span class="number">0.0049</span>,<span class="number">0.323</span>,<span class="number">0.272</span>]},
        {nm: <span class="number">505</span>, xyz: [<span class="number">0.0024</span>,<span class="number">0.4073</span>,<span class="number">0.2123</span>]},
        {nm: <span class="number">510</span>, xyz: [<span class="number">0.0093</span>,<span class="number">0.503</span>,<span class="number">0.1582</span>]},
        {nm: <span class="number">515</span>, xyz: [<span class="number">0.0291</span>,<span class="number">0.6082</span>,<span class="number">0.1117</span>]},
        {nm: <span class="number">520</span>, xyz: [<span class="number">0.06327</span>,<span class="number">0.71</span>,<span class="number">0.07825</span>]},
        {nm: <span class="number">525</span>, xyz: [<span class="number">0.1096</span>,<span class="number">0.7932</span>,<span class="number">0.05725</span>]},
        {nm: <span class="number">530</span>, xyz: [<span class="number">0.1655</span>,<span class="number">0.862</span>,<span class="number">0.04216</span>]},
        {nm: <span class="number">535</span>, xyz: [<span class="number">0.22575</span>,<span class="number">0.91485</span>,<span class="number">0.02984</span>]},
        {nm: <span class="number">540</span>, xyz: [<span class="number">0.2904</span>,<span class="number">0.954</span>,<span class="number">0.0203</span>]},
        {nm: <span class="number">545</span>, xyz: [<span class="number">0.3597</span>,<span class="number">0.9803</span>,<span class="number">0.0134</span>]},
        {nm: <span class="number">550</span>, xyz: [<span class="number">0.43345</span>,<span class="number">0.99495</span>,<span class="number">0.00875</span>]},
        {nm: <span class="number">555</span>, xyz: [<span class="number">0.51205</span>,<span class="number">1</span>,<span class="number">0.00575</span>]},
        {nm: <span class="number">560</span>, xyz: [<span class="number">0.5945</span>,<span class="number">0.995</span>,<span class="number">0.0039</span>]},
        {nm: <span class="number">565</span>, xyz: [<span class="number">0.6784</span>,<span class="number">0.9786</span>,<span class="number">0.00275</span>]},
        {nm: <span class="number">570</span>, xyz: [<span class="number">0.7621</span>,<span class="number">0.952</span>,<span class="number">0.0021</span>]},
        {nm: <span class="number">575</span>, xyz: [<span class="number">0.8425</span>,<span class="number">0.9154</span>,<span class="number">0.0018</span>]},
        {nm: <span class="number">580</span>, xyz: [<span class="number">0.9163</span>,<span class="number">0.87</span>,<span class="number">0.00165</span>]},
        {nm: <span class="number">585</span>, xyz: [<span class="number">0.9786</span>,<span class="number">0.8163</span>,<span class="number">0.0014</span>]},
        {nm: <span class="number">590</span>, xyz: [<span class="number">1.0263</span>,<span class="number">0.757</span>,<span class="number">0.0011</span>]},
        {nm: <span class="number">595</span>, xyz: [<span class="number">1.0567</span>,<span class="number">0.6949</span>,<span class="number">0.001</span>]},
        {nm: <span class="number">600</span>, xyz: [<span class="number">1.0622</span>,<span class="number">0.631</span>,<span class="number">0.0008</span>]},
        {nm: <span class="number">605</span>, xyz: [<span class="number">1.0456</span>,<span class="number">0.5668</span>,<span class="number">0.0006</span>]},
        {nm: <span class="number">610</span>, xyz: [<span class="number">1.0026</span>,<span class="number">0.503</span>,<span class="number">0.00034</span>]},
        {nm: <span class="number">615</span>, xyz: [<span class="number">0.9384</span>,<span class="number">0.4412</span>,<span class="number">0.00024</span>]},
        {nm: <span class="number">620</span>, xyz: [<span class="number">0.85445</span>,<span class="number">0.381</span>,<span class="number">0.00019</span>]},
        {nm: <span class="number">625</span>, xyz: [<span class="number">0.7514</span>,<span class="number">0.321</span>,<span class="number">0.0001</span>]},
        {nm: <span class="number">630</span>, xyz: [<span class="number">0.6424</span>,<span class="number">0.265</span>,<span class="number">0.00005</span>]},
        {nm: <span class="number">635</span>, xyz: [<span class="number">0.5419</span>,<span class="number">0.217</span>,<span class="number">0.00003</span>]},
        {nm: <span class="number">640</span>, xyz: [<span class="number">0.4479</span>,<span class="number">0.175</span>,<span class="number">0.00002</span>]},
        {nm: <span class="number">645</span>, xyz: [<span class="number">0.3608</span>,<span class="number">0.1382</span>,<span class="number">0.00001</span>]},
        {nm: <span class="number">650</span>, xyz: [<span class="number">0.2835</span>,<span class="number">0.107</span>,<span class="number">0</span>]},
        {nm: <span class="number">655</span>, xyz: [<span class="number">0.2187</span>,<span class="number">0.0816</span>,<span class="number">0</span>]},
        {nm: <span class="number">660</span>, xyz: [<span class="number">0.1649</span>,<span class="number">0.061</span>,<span class="number">0</span>]},
        {nm: <span class="number">665</span>, xyz: [<span class="number">0.1212</span>,<span class="number">0.04458</span>,<span class="number">0</span>]},
        {nm: <span class="number">670</span>, xyz: [<span class="number">0.0874</span>,<span class="number">0.032</span>,<span class="number">0</span>]},
        {nm: <span class="number">675</span>, xyz: [<span class="number">0.0636</span>,<span class="number">0.0232</span>,<span class="number">0</span>]},
        {nm: <span class="number">680</span>, xyz: [<span class="number">0.04677</span>,<span class="number">0.017</span>,<span class="number">0</span>]},
        {nm: <span class="number">685</span>, xyz: [<span class="number">0.0329</span>,<span class="number">0.01192</span>,<span class="number">0</span>]},
        {nm: <span class="number">690</span>, xyz: [<span class="number">0.0227</span>,<span class="number">0.00821</span>,<span class="number">0</span>]},
        {nm: <span class="number">695</span>, xyz: [<span class="number">0.01584</span>,<span class="number">0.005723</span>,<span class="number">0</span>]},
        {nm: <span class="number">700</span>, xyz: [<span class="number">0.011359</span>,<span class="number">0.004102</span>,<span class="number">0</span>]},
        {nm: <span class="number">705</span>, xyz: [<span class="number">0.008111</span>,<span class="number">0.002929</span>,<span class="number">0</span>]},
        {nm: <span class="number">710</span>, xyz: [<span class="number">0.00579</span>,<span class="number">0.002091</span>,<span class="number">0</span>]},
        {nm: <span class="number">715</span>, xyz: [<span class="number">0.004109</span>,<span class="number">0.001484</span>,<span class="number">0</span>]},
        {nm: <span class="number">720</span>, xyz: [<span class="number">0.002899</span>,<span class="number">0.001047</span>,<span class="number">0</span>]},
        {nm: <span class="number">725</span>, xyz: [<span class="number">0.002049</span>,<span class="number">0.00074</span>,<span class="number">0</span>]},
        {nm: <span class="number">730</span>, xyz: [<span class="number">0.00144</span>,<span class="number">0.00052</span>,<span class="number">0</span>]},
        {nm: <span class="number">735</span>, xyz: [<span class="number">0.001</span>,<span class="number">0.000361</span>,<span class="number">0</span>]},
        {nm: <span class="number">740</span>, xyz: [<span class="number">0.00069</span>,<span class="number">0.000249</span>,<span class="number">0</span>]},
        {nm: <span class="number">745</span>, xyz: [<span class="number">0.000476</span>,<span class="number">0.000172</span>,<span class="number">0</span>]},
        {nm: <span class="number">750</span>, xyz: [<span class="number">0.000332</span>,<span class="number">0.00012</span>,<span class="number">0</span>]},
        {nm: <span class="number">755</span>, xyz: [<span class="number">0.000235</span>,<span class="number">0.000085</span>,<span class="number">0</span>]},
        {nm: <span class="number">760</span>, xyz: [<span class="number">0.000166</span>,<span class="number">0.00006</span>,<span class="number">0</span>]},
        {nm: <span class="number">765</span>, xyz: [<span class="number">0.000117</span>,<span class="number">0.000042</span>,<span class="number">0</span>]},
        {nm: <span class="number">770</span>, xyz: [<span class="number">0.000083</span>,<span class="number">0.00003</span>,<span class="number">0</span>]},
        {nm: <span class="number">775</span>, xyz: [<span class="number">0.000059</span>,<span class="number">0.000021</span>,<span class="number">0</span>]},
        {nm: <span class="number">780</span>, xyz: [<span class="number">0.000042</span>,<span class="number">0.000015</span>,<span class="number">0</span>]}
    ]
};






<span class="comment">/* Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Inspired by base2 and Prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(){
  <span class="keyword">var</span> initializing = <span class="literal">false</span>, fnTest = <span class="regexp">/xyz/</span>.test(<span class="keyword">function</span>(){xyz;}) ? <span class="regexp">/\b_super\b/</span> : <span class="regexp">/.*/</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>The base Class implementation (does nothing)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">this</span>.Class = <span class="keyword">function</span>(){};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Create a new Class that inherits from this class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Class.extend = <span class="keyword">function</span>(prop) {
    <span class="keyword">var</span> _super = <span class="keyword">this</span>.prototype;</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Instantiate a base class (but only create the instance,
don&#39;t run the init constructor)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initializing = <span class="literal">true</span>;
    <span class="keyword">var</span> prototype = <span class="keyword">new</span> <span class="keyword">this</span>();
    initializing = <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Copy the properties over onto the new prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> prop) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Check if we&#39;re overwriting an existing function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      prototype[name] = <span class="keyword">typeof</span> prop[name] == <span class="string">"function"</span> &amp;&amp;
        <span class="keyword">typeof</span> _super[name] == <span class="string">"function"</span> &amp;&amp; fnTest.test(prop[name]) ?
        (<span class="keyword">function</span>(name, fn){
          <span class="keyword">return</span> <span class="keyword">function</span>() {
            <span class="keyword">var</span> tmp = <span class="keyword">this</span>._super;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Add a new ._super() method that is the same method
but on the super-class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>._super = _super[name];</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>The method only need to be bound temporarily, so we
remove it when we&#39;re done executing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> ret = fn.apply(<span class="keyword">this</span>, arguments);
            <span class="keyword">this</span>._super = tmp;

            <span class="keyword">return</span> ret;
          };
        })(name, prop[name]) :
        prop[name];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>The dummy class constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="keyword">function</span> <span class="title">Class</span><span class="params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>All construction is actually done in the init method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> ( !initializing &amp;&amp; <span class="keyword">this</span>.init )
        <span class="keyword">this</span>.init.apply(<span class="keyword">this</span>, arguments);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Populate our constructed prototype object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Class.prototype = prototype;</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Enforce the constructor to be what we expect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Class.prototype.constructor = Class;</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>And make this class extendable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Class.extend = arguments.callee;

    <span class="keyword">return</span> Class;
  };
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
